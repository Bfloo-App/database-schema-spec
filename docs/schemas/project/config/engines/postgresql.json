{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "PostgreSQL Configuration",
  "description": "Schema for PostgreSQL-specific configuration including environment connection parameters. All connection parameters follow the official PostgreSQL libpq specification.",
  "type": "object",
  "properties": {
    "envs": {
      "$ref": "#/$defs/envs"
    }
  },
  "required": ["envs"],
  "additionalProperties": false,
  "$defs": {
    "envs": {
      "type": "object",
      "description": "Environment-specific connection configurations (e.g., development, staging, production)",
      "additionalProperties": {
        "$ref": "#/$defs/environment"
      },
      "minProperties": 1
    },
    "environment": {
      "type": "object",
      "description": "Connection configuration for a single environment",
      "properties": {
        "host": {
          "type": "string",
          "description": "Name of host to connect to. If starts with '/', it specifies Unix-domain socket directory. A comma-separated list is also accepted for multiple hosts.",
          "minLength": 1,
          "maxLength": 1024,
          "examples": ["localhost", "db.example.com", "/var/run/postgresql", "host1,host2,host3"]
        },
        "hostaddr": {
          "type": "string",
          "description": "Numeric IP address of host to connect to (IPv4 or IPv6). Bypasses DNS lookup. Can be comma-separated list matching host entries.",
          "minLength": 1,
          "maxLength": 1024,
          "examples": ["127.0.0.1", "192.168.1.100", "::1", "2001:db8::1234"]
        },
        "port": {
          "type": "integer",
          "description": "Port number to connect to at the server host. Default is 5432.",
          "minimum": 1,
          "maximum": 65535,
          "default": 5432,
          "examples": [5432, 5433, 6432]
        },
        "dbname": {
          "type": "string",
          "description": "The database name. Supports environment variable interpolation with ${VAR_NAME} syntax.",
          "minLength": 1,
          "maxLength": 63,
          "pattern": "^[a-zA-Z_][a-zA-Z0-9_$]*$|^\\$\\{[A-Z_][A-Z0-9_]*\\}$"
        },
        "target-schema": {
          "type": "string",
          "description": "PostgreSQL schema name. Defaults to 'public' if not specified.",
          "minLength": 1,
          "maxLength": 63,
          "pattern": "^[a-zA-Z_][a-zA-Z0-9_$]*$|^\\$\\{[A-Z_][A-Z0-9_]*\\}$",
          "default": "public"
        },
        "user": {
          "type": "string",
          "description": "PostgreSQL user name to connect as. Supports environment variable interpolation with ${VAR_NAME} syntax.",
          "minLength": 1,
          "maxLength": 63
        },
        "password": {
          "type": "string",
          "description": "Password for authentication. IMPORTANT: Use environment variable interpolation (${VAR_NAME}) - never store plaintext passwords.",
          "minLength": 1
        },
        "require_auth": {
          "type": "string",
          "description": "Authentication method required from server. Comma-separated list allowed. Prefix with '!' to negate.",
          "enum": [
            "password",
            "md5",
            "gss",
            "sspi",
            "scram-sha-256",
            "none",
            "!password",
            "!md5",
            "!gss",
            "!sspi",
            "!scram-sha-256",
            "!none"
          ]
        },
        "connect_timeout": {
          "type": "integer",
          "description": "Maximum time to wait while connecting, in seconds. Zero means wait indefinitely.",
          "minimum": 0,
          "maximum": 2147483647,
          "default": 0
        },
        "sslmode": {
          "type": "string",
          "description": "Determines SSL connection negotiation priority with the server.",
          "enum": ["disable", "allow", "prefer", "require", "verify-ca", "verify-full"],
          "default": "prefer"
        },
        "env-file": {
          "type": "string",
          "description": "Path to an environment file (relative to project root) for this specific environment. Overrides the schema-level env-file. Used to resolve ${VAR_NAME} references in connection parameters.",
          "examples": [".env.production", ".env.staging", "config/.env.dev"]
        }
      },
      "required": ["host", "dbname", "user"],
      "additionalProperties": false
    }
  }
}

{
  "title": "PostgreSQL Constraint Definition",
  "type": "object",
  "properties": {
    "id": {
      "type": "integer",
      "description": "Unique local identifier for the constraint",
      "examples": [1, 2, 3, 4, 5]
    },
    "name": {
      "type": "string",
      "description": "Name of the constraint",
      "pattern": "^[a-z][a-z0-9_]*$",
      "minLength": 1,
      "maxLength": 63,
      "examples": [
        "pk_composite_key",
        "fk_users_parent",
        "unique_full_name",
        "fk_parent_category",
        "fk_product_category",
        "fk_product_supplier",
        "unique_product_warehouse",
        "fk_inventory_product",
        "fk_inventory_warehouse",
        "fk_orders_user",
        "fk_order_items_order",
        "unique_order_product"
      ]
    },
    "type": {
      "type": "string",
      "description": "Type of the constraint",
      "enum": ["foreign_key", "unique", "primary_key"]
    },
    "description": {
      "type": "string",
      "description": "Description of the constraint",
      "maxLength": 256,
      "examples": [
        "Composite primary key for the table",
        "Self-referencing foreign key to create user hierarchy",
        "Ensure combination of first and last name is unique",
        "Self-referencing foreign key for category hierarchy",
        "Foreign key to product categories table",
        "Foreign key to suppliers table",
        "Each product can only have one inventory record per warehouse",
        "Foreign key to products table",
        "Foreign key to warehouses table",
        "Foreign key to users table",
        "Foreign key to orders table",
        "Ensure each product appears only once per order"
      ]
    },
    "columns": {
      "type": "array",
      "description": "List of column names that this constraint applies to",
      "items": { "type": "string" },
      "examples": [["parent_id"], ["first_name", "last_name"]]
    }
  },
  "required": ["id", "name", "type", "columns"],
  "allOf": [
    {
      "if": {
        "properties": {
          "type": {
            "const": "foreign_key"
          }
        }
      },
      "then": {
        "properties": {
          "references": {
            "type": "object",
            "description": "Table and column that this foreign key references",
            "properties": {
              "table": {
                "type": "string",
                "description": "Name of the referenced table",
                "pattern": "^[a-z][a-z0-9_]*$",
                "minLength": 1,
                "maxLength": 63,
                "examples": ["users", "orders", "products"]
              },
              "columns": {
                "type": "array",
                "description": "List of referenced column names",
                "items": {
                  "type": "string",
                  "pattern": "^[a-z][a-z0-9_]*$",
                  "minLength": 1,
                  "maxLength": 63
                },
                "examples": [["id"], ["user_id"], ["product_id"], ["product_id", "warehouse_id"]]
              }
            },
            "required": ["table", "columns"],
            "additionalProperties": false
          },
          "on_delete": {
            "type": "string",
            "description": "Action to take when referenced row is deleted",
            "enum": ["cascade", "set_null", "set_default", "restrict", "no_action"],
            "examples": ["cascade", "set_null", "restrict"]
          },
          "on_update": {
            "type": "string",
            "description": "Action to take when referenced row is updated",
            "enum": ["cascade", "set_null", "set_default", "restrict", "no_action"],
            "examples": ["cascade", "set_null", "restrict"]
          }
        },
        "required": ["references", "on_delete", "on_update"]
      }
    }
  ],
  "additionalProperties": false
}
